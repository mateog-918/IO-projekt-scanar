swagger: "2.0"
info:
  title: "SCANAR API - System kontroli dostępu"
  description: "API dla systemu weryfikacji dostępu pracowników (QR + rozpoznawanie twarzy)"
  version: "1.0.0"
  contact:
    name: "SCANAR Team"

host: "localhost:5000"
basePath: "/api"
schemes:
  - "http"

tags:
  - name: "Verification"
    description: "Endpointy weryfikacji dostępu"
  - name: "Employees"
    description: "Zarządzanie pracownikami"

paths:
  /verification/qr:
    post:
      tags:
        - "Verification"
      summary: "Weryfikacja QR kodu"
      description: "Skanuje QR kod i zwraca dane pracownika"
      consumes:
        - "application/json"
      produces:
        - "application/json"
      parameters:
        - in: "body"
          name: "body"
          description: "Dane QR kodu do weryfikacji"
          required: true
          schema:
            type: "object"
            required:
              - qr_data
            properties:
              qr_data:
                type: "string"
                example: "a1b2c3d4e5f6..."
                description: "Hash QR kodu pracownika"
      responses:
        200:
          description: "QR kod zweryfikowany poprawnie"
          schema:
            type: "object"
            properties:
              success:
                type: "boolean"
                example: true
              message:
                type: "string"
                example: "Witaj, Jan Kowalski"
              employee:
                type: "object"
                properties:
                  id:
                    type: "integer"
                    example: 1
                  name:
                    type: "string"
                    example: "Jan Kowalski"
                  position:
                    type: "string"
                    example: "Engineer"
                  department:
                    type: "string"
                    example: "IT"
                  qr_code_hash:
                    type: "string"
                  is_active:
                    type: "boolean"
                  created_at:
                    type: "string"
                    format: "date-time"
        400:
          description: "Brak danych QR"
          schema:
            type: "object"
            properties:
              success:
                type: "boolean"
                example: false
              message:
                type: "string"
                example: "Brak danych QR kodu"
              employee:
                type: "null"
        404:
          description: "Nie znaleziono pracownika"
          schema:
            type: "object"
            properties:
              success:
                type: "boolean"
                example: false
              message:
                type: "string"
                example: "Nie znaleziono pracownika dla podanego QR kodu"
              employee:
                type: "null"
        500:
          description: "Błąd serwera"

  /manage_employees/:
    post:
      tags:
        - "Employees"
      summary: "Dodaj nowego pracownika"
      description: "Tworzy nowego pracownika i automatycznie generuje QR kod"
      consumes:
        - "application/json"
      produces:
        - "application/json"
      parameters:
        - in: "body"
          name: "body"
          description: "Dane nowego pracownika"
          required: true
          schema:
            type: "object"
            required:
              - name
            properties:
              name:
                type: "string"
                example: "Jan Kowalski"
                description: "Imię i nazwisko pracownika"
              position:
                type: "string"
                example: "Engineer"
                description: "Stanowisko"
              department:
                type: "string"
                example: "IT"
                description: "Dział"
      responses:
        201:
          description: "Pracownik utworzony"
          schema:
            type: "object"
            properties:
              success:
                type: "boolean"
                example: true
              message:
                type: "string"
                example: "Pracownik utworzony pomyślnie"
              employee:
                type: "object"
                properties:
                  id:
                    type: "integer"
                  name:
                    type: "string"
                  position:
                    type: "string"
                  department:
                    type: "string"
                  qr_code_hash:
                    type: "string"
                  is_active:
                    type: "boolean"
                  created_at:
                    type: "string"
              qr_code:
                type: "string"
                example: "a1b2c3d4e5f6..."
                description: "Wygenerowany hash QR kodu"
        400:
          description: "Błąd walidacji"
        500:
          description: "Błąd serwera"
    
    get:
      tags:
        - "Employees"
      summary: "Pobierz listę pracowników"
      description: "Zwraca wszystkich aktywnych pracowników"
      produces:
        - "application/json"
      responses:
        200:
          description: "Lista pracowników"
          schema:
            type: "object"
            properties:
              success:
                type: "boolean"
              employees:
                type: "array"
                items:
                  type: "object"
                  properties:
                    id:
                      type: "integer"
                    name:
                      type: "string"
                    position:
                      type: "string"
                    department:
                      type: "string"
                    qr_code_hash:
                      type: "string"
                    is_active:
                      type: "boolean"
                    created_at:
                      type: "string"
        500:
          description: "Błąd serwera"

  /manage_employees/{employee_id}:
    get:
      tags:
        - "Employees"
      summary: "Pobierz dane pracownika"
      description: "Zwraca szczegóły pracownika po ID"
      produces:
        - "application/json"
      parameters:
        - in: "path"
          name: "employee_id"
          description: "ID pracownika"
          required: true
          type: "integer"
      responses:
        200:
          description: "Dane pracownika"
          schema:
            type: "object"
            properties:
              success:
                type: "boolean"
              employee:
                type: "object"
        404:
          description: "Nie znaleziono pracownika"
        500:
          description: "Błąd serwera"

  /manage_employees/{employee_id}/faces:
    post:
      tags:
        - "Employees"
      summary: "Dodaj zdjęcie twarzy pracownika"
      description: "Dodaje zdjęcie twarzy i przechowuje embedding (max 5 zdjęć na pracownika). Uses fixed matching tolerance of 0.6 for any comparisons."
      consumes:
        - "multipart/form-data"
      produces:
        - "application/json"
      parameters:
        - in: "path"
          name: "employee_id"
          description: "ID pracownika"
          required: true
          type: "integer"
        - in: "formData"
          name: "image"
          type: "file"
          required: true
          description: "Plik obrazu z twarzą"
      responses:
        200:
          description: "Obraz dodany"
          schema:
            type: "object"
            properties:
              success:
                type: "boolean"
                example: true
              message:
                type: "string"
                example: "Image added"
              image_path:
                type: "string"
                example: "static/face_images/1_abcd1234.jpg"
              count:
                type: "integer"
                example: 1
        400:
          description: "Błąd walidacji (np. brak obrazu, brak twarzy, limit osiągnięty)"
        404:
          description: "Nie znaleziono pracownika"
        500:
          description: "Błąd serwera"

  /verification/employees/{employee_id}/match:
    post:
      tags:
        - "Verification"
      summary: "Porównaj przesłane zdjęcie z encodigami pracownika"
      description: "Przesyła obraz i zwraca czy dopasowano do jednego z zapisanych encodigów. Uses a fixed matching tolerance of 0.6 (not configurable via the API)."
      consumes:
        - "multipart/form-data"
      produces:
        - "application/json"
      parameters:
        - in: "path"
          name: "employee_id"
          required: true
          type: "integer"
          description: "ID pracownika"
        - in: "formData"
          name: "image"
          type: "file"
          required: true
          description: "Plik obrazu z twarzą"
      responses:
        200:
          description: "Zwraca wynik dopasowania"
          schema:
            type: "object"
            properties:
              match:
                type: "boolean"
                example: true
        400:
          description: "Brak obrazu lub brak twarzy w obrazie"
        404:
          description: "Nie znaleziono pracownika"
        500:
          description: "Błąd serwera"

definitions:
  Employee:
    type: "object"
    required:
      - id
      - name
    properties:
      id:
        type: "integer"
        description: "Unikalne ID pracownika"
        example: 1
      name:
        type: "string"
        description: "Imię i nazwisko pracownika"
        example: "Jan Kowalski"
      position:
        type: "string"
        description: "Stanowisko pracownika"
        example: "Engineer"
      department:
        type: "string"
        description: "Dział"
        example: "IT"
      qr_code_hash:
        type: "string"
        description: "Hash powiązany z wygenerowanym QR kodem"
      is_active:
        type: "boolean"
        description: "Czy konto pracownika jest aktywne"
      created_at:
        type: "string"
        format: "date-time"
        description: "Data utworzenia rekordu"
      face_image_paths:
        type: "array"
        description: "Lista ścieżek do zapisanych zdjęć twarzy (maksymalnie 5)"
        items:
          type: "string"
        example: ["static/face_images/1_a.jpg", "static/face_images/1_b.jpg"]
      face_encoding_count:
        type: "integer"
        description: "Liczba zapisanych wektorów twarzy (encodingów) dla pracownika"
        example: 2